<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unicorn Ranch (React)</title>
<meta name="description" content="Raise a baby unicorn ‚Äì feed, drink, play, and nap!" />
<style>
  :root{
    --sky1:#9fd3ff; --sky2:#cfe8ff; --grass:#b8e986; --water:#9fd3ff;
    --barn1:#f77; --barn2:#d26; --dirt:#e2c39a;
  }
  html,body{
    margin:0; height:100%;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:linear-gradient(var(--sky1),var(--sky2) 30%,var(--grass) 30%);
  }
  #app{min-height:100dvh; display:grid; place-items:center; padding:12px;}

  .world{
    position:relative;
    width:min(96vw,1100px);
    aspect-ratio:16/10;
    border-radius:24px; overflow:hidden;
    box-shadow:0 10px 40px rgba(0,0,0,.15);
    background:linear-gradient(var(--sky1),var(--sky2) 35%, var(--grass) 35%);
  }
  .night{ filter:brightness(.85) saturate(.9); }

  /* Top UI */
  .ui{ position:absolute; inset:12px 12px auto 12px; display:flex; flex-wrap:wrap; gap:10px; }
  .card{
    background:rgba(255,255,255,.92);
    padding:10px 12px; border-radius:14px;
    box-shadow:0 2px 8px rgba(0,0,0,.1);
    display:flex; flex-direction:column; gap:8px;
    max-width:calc(100% - 24px);
  }
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
  .pill{display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; background:#fff; font-weight:600;}
  .btn{cursor:pointer; padding:6px 12px; border-radius:10px; border:none; font-weight:700; background:#fff;}

  /* Meters */
  .meters{display:flex; gap:8px; flex-wrap:wrap;}
  .meter{width:130px; max-width:28vw; height:10px; background:#d3d3d3; border-radius:20px; overflow:hidden;}
  .fill{display:block; height:100%; background:black; transition:width .25s linear;}

  /* 2√ó2 grid for zones */
  .grid{
    position:absolute; left:2%; right:2%; top:28%; bottom:4%;
    display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr; gap:2.5%;
  }
  .zone{position:relative; border-radius:20px; outline:4px solid rgba(255,255,255,.6); overflow:hidden;}
  .label{position:absolute; top:8px; left:8px; padding:4px 10px; background:rgba(255,255,255,.9); border-radius:12px; font-weight:700; font-size:14px; z-index:2;}
  .lake{background:radial-gradient(circle at 40% 30%, #e7f6ff, var(--water));}
  .field{background:repeating-linear-gradient(45deg, rgba(255,255,255,.35), rgba(255,255,255,.35) 10px, transparent 10px, transparent 20px);}
  .play{background:linear-gradient(135deg, #fef3bd, #ffd6a5);}
  .barn{background:linear-gradient(var(--barn1), var(--barn2));}
  .barn .door{position:absolute; left:50%; bottom:0; transform:translateX(-50%); width:28%; height:60%; background:#4b8a16; border:6px solid #2f2614; border-bottom:none; border-radius:10px 10px 0 0;}
  .barn .stoop{position:absolute; left:14%; right:14%; bottom:-8%; height:14%; background:var(--dirt); border-radius:20px;}

  /* Unicorn */
  .unicorn{position:absolute; width:min(12vmin, 120px); height:min(12vmin, 120px); translate:-50% -50%; user-select:none; touch-action:none;}
  .u-emoji{font-size:64px; line-height:1; position:absolute; left:50%; top:50%; translate:-50% -50%;}
  .speech{position:absolute; left:0; top:-12px; translate:-10% -100%; background:#fff; padding:6px 10px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.2); font-weight:700;}

  /* Pause modal */
  .modal{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.5);}
  .panel{background:#fff; padding:18px; border-radius:16px; width:min(92%,520px);}
</style>
</head>
<body>
  <div id="app"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const {useState,useRef,useEffect} = React;
    const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
    const STORAGE_KEY='unicorn_ranch_react_v8';

    const DRAIN = { hunger: 1.2, thirst: 1.6, energy: 0.9, fun: 1.4 };
    const RECHARGE = { lake: {thirst: 7}, field: {hunger: 7}, barn: {energy: 9}, play: {fun: 7} };

    function useLocalStorageState(key, initial){
      const [state,setState]=useState(()=>{ try{ const raw=localStorage.getItem(key); return raw? JSON.parse(raw): initial;}catch{ return initial; }});
      useEffect(()=>{ try{ localStorage.setItem(key, JSON.stringify(state)); }catch{} },[state]);
      return [state,setState];
    }

    function App(){
      const initial={ x:15, y:25, needs:{hunger:80,thirst:80,energy:80,fun:70}, age:0, stage:'Baby', wins:{fed:0,drank:0,napped:0,played:0} };
      const [s,setS]=useLocalStorageState(STORAGE_KEY, initial);
      const [dragging,setDragging]=useState(false);
      const [now,setNow]=useState(Date.now());
      const [msg,setMsg]=useState('');
      const [showPause,setShowPause]=useState(false);
      const worldRef=useRef(null);

      const dayMs=6*60*1000;
      useEffect(()=>{ const id=setInterval(()=>setNow(Date.now()),1000); return ()=>clearInterval(id); },[]);
      const isNight = ((now%dayMs)/dayMs)>0.7 || ((now%dayMs)/dayMs)<0.2;

      useEffect(()=>{
        const dt = 0.1;
        const id = setInterval(()=>{
          setS(prev=>{
            const current = hitZoneAtPercent(prev.x, prev.y);
            const needs = {...prev.needs};

            needs.hunger = clamp(needs.hunger - DRAIN.hunger*dt, 0, 100);
            needs.thirst = clamp(needs.thirst - DRAIN.thirst*dt, 0, 100);
            needs.energy = clamp(needs.energy - DRAIN.energy*dt, 0, 100);
            needs.fun    = clamp(needs.fun    - DRAIN.fun*dt,    0, 100);

            if(current==='lake')  needs.thirst = clamp(needs.thirst + RECHARGE.lake.thirst*dt, 0, 100);
            if(current==='field') needs.hunger = clamp(needs.hunger + RECHARGE.field.hunger*dt, 0, 100);
            if(current==='barn')  needs.energy = clamp(needs.energy + RECHARGE.barn.energy*dt, 0, 100);
            if(current==='play')  needs.fun    = clamp(needs.fun    + RECHARGE.play.fun*dt,    0, 100);

            return {...prev, needs};
          });
        }, dt*1000);
        return ()=>clearInterval(id);
      },[]);

      function posToPercent(e){
        const r=worldRef.current.getBoundingClientRect();
        const cx=(e.clientX??e.touches?.[0]?.clientX)-r.left;
        const cy=(e.clientY??e.touches?.[0]?.clientY)-r.top;
        return {x:clamp((cx/r.width)*100,0,100), y:clamp((cy/r.height)*100,0,100)};
      }
      function onStart(e){ setDragging(true); const {x,y}=posToPercent(e); setS(p=>({...p,x,y})); }
      function onMove(e){ if(!dragging) return; const {x,y}=posToPercent(e); setS(p=>({...p,x,y})); }
      function onEnd(){ setDragging(false); }

      function hitZoneAtPercent(xPct, yPct){
        if(!worldRef.current) return null;
        const rWorld=worldRef.current.getBoundingClientRect();
        const px=rWorld.left + (xPct/100)*rWorld.width;
        const py=rWorld.top  + (yPct/100)*rWorld.height;
        const els=[...worldRef.current.querySelectorAll('.grid > .zone')];
        for(const el of els){
          const rr=el.getBoundingClientRect();
          if(px>rr.left && px<rr.right && py>rr.top && py<rr.bottom){
            if(el.classList.contains('lake')) return 'lake';
            if(el.classList.contains('field')) return 'field';
            if(el.classList.contains('play')) return 'play';
            if(el.classList.contains('barn')) return 'barn';
          }
        }
        return null;
      }

      const currentZone = hitZoneAtPercent(s.x, s.y);

      return (
        <div className={"world"+(isNight?" night":"")}
             ref={worldRef}
             onMouseMove={onMove} onMouseUp={onEnd}
             onTouchMove={onMove} onTouchEnd={onEnd}
        >
          <div className="ui">
            <div className="card">
              <div className="row">
                <strong>Unicorn Ranch</strong>
                <span className="pill">Stage: {s.stage}</span>
                {currentZone && <span className="pill">Here: {
                  currentZone==='lake'?'Lake üíß':currentZone==='field'?'Field üçé':currentZone==='barn'?'Barn üí§':'Play üéà'
                }</span>}
              </div>
              <div className="meters">
                {Object.entries({hunger:"üçé",thirst:"üíß",energy:"üõå",fun:"üéà"}).map(([k,em])=>{
                  const v=s.needs[k];
                  return (
                    <span className="pill" key={k}>
                      <span style={{fontSize:18}}>{em}</span>
                      <span className="meter"><span className="fill" style={{width:`${v}%`}}/></span>
                    </span>
                  );
                })}
              </div>
            </div>
          </div>

          <div className="grid">
            <div className="zone lake"><div className="label">Lake üíß</div></div>
            <div className="zone barn"><div className="label">Barn üí§</div><div className="door"></div><div className="stoop"></div></div>
            <div className="zone field"><div className="label">Field üçé</div></div>
            <div className="zone play"><div className="label">Play üéà</div></div>
          </div>

          <div className="unicorn" style={{left:`${s.x}%`, top:`${s.y}%`}}
               onMouseDown={onStart} onTouchStart={onStart}>
            <div className="u-emoji">ü¶Ñ</div>
            {msg && <div className="speech">{msg}</div>}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(<App/>);
  </script>
</body>
</html>
