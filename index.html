<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Unicorn Ranch</title>
<meta name="description" content="Keep the unicorn's needs filled to level up!" />
<style>
  :root{
    --sky1:#9fd3ff; --sky2:#cfe8ff; --grass:#b8e986; --water:#9fd3ff;
    --barn1:#f77; --barn2:#d26; --dirt:#e2c39a;
  }
  html,body{ margin:0; height:100%; background:linear-gradient(var(--sky1),var(--sky2) 30%,var(--grass) 30%); }
  body{ font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
  #app{ min-height:100dvh; display:flex; justify-content:center; padding:8px; }

  .world{
    display:flex; flex-direction:column;
    width:100%; max-width:1100px;
    height:100dvh;
    border-radius:24px;
    overflow:hidden;
    box-shadow:0 10px 40px rgba(0,0,0,.15);
    background:linear-gradient(var(--sky1),var(--sky2) 35%, var(--grass) 35%);
  }

  /* Top UI */
  .ui{
    padding:8px;
    background:rgba(255,255,255,.92);
    display:flex; flex-direction:column; gap:8px;
    z-index:2;
  }
  .row{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
  .pill{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; background:#fff; font-weight:700; font-size:clamp(12px, 1.8vw, 16px); }
  .btn{ cursor:pointer; padding:6px 10px; border-radius:12px; border:none; font-weight:700; background:#fff; font-size:clamp(12px, 1.8vw, 16px); }
  .btn:active{ transform:translateY(1px); }

  /* Meters */
  .meters{ display:flex; gap:8px; flex-wrap:wrap; }
  .meter{ width:clamp(120px, 24vw, 200px); height:clamp(10px, 2vh, 16px); background:#d3d3d3; border-radius:20px; overflow:hidden; }
  .fill{ height:100%; transition:width .15s linear, background-color .15s linear; }

  /* Grid */
  .grid{ flex:1; display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr; gap:clamp(8px, 2vmin, 20px); padding:8px; }
  .zone{ position:relative; border-radius:20px; outline:4px solid rgba(255,255,255,.6); overflow:hidden; }
  .label{ position:absolute; top:8px; left:8px; padding:4px 8px; background:rgba(255,255,255,.9); border-radius:12px; font-weight:700; font-size:clamp(12px, 1.8vw, 16px); z-index:2; }
  .lake{ background:radial-gradient(circle at 40% 30%, #e7f6ff, var(--water)); }
  .field{ background:repeating-linear-gradient(45deg, rgba(255,255,255,.35), rgba(255,255,255,.35) 10px, transparent 10px, transparent 20px); }
  .play{ background:linear-gradient(135deg, #fef3bd, #ffd6a5); }
  .barn{ background:linear-gradient(var(--barn1), var(--barn2)); }
  .barn .door{ position:absolute; left:50%; bottom:0; transform:translateX(-50%); width:28%; height:60%; background:#4b8a16; border:6px solid #2f2614; border-bottom:none; border-radius:10px 10px 0 0; }
  .barn .stoop{ position:absolute; left:14%; right:14%; bottom:-8%; height:14%; background:var(--dirt); border-radius:20px; }

  /* Unicorn */
  .unicorn{
    position:absolute; width:clamp(64px, 12vmin, 120px); aspect-ratio:1/1;
    user-select:none; touch-action:none; z-index:3;
    transform:translate(-50%,-50%);
  }
  .u-emoji{ font-size:clamp(44px, 8vmin, 64px); }

  /* Monster */
  .monster{
    position:absolute; top:50%; transform:translateY(-50%);
    font-size:clamp(64px, 14vmin, 120px);
    animation:runAcross 4s linear forwards;
    z-index:4;
  }
  @keyframes runAcross{
    from{ left:-20%; }
    to{ left:120%; }
  }

  /* Modal */
  .modal{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.5); z-index:5; }
  .panel{ background:#fff; padding:clamp(16px, 3vmin, 22px); border-radius:16px; width:min(92%,520px); text-align:center; }
  .panel h2{ margin:0 0 10px; font-size:clamp(18px, 3.2vmin, 22px); }
  .panel p{ margin:0 0 16px; font-size:clamp(14px, 2.6vmin, 18px); }
</style>
</head>
<body>
<div id="app"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
const {useState,useRef,useEffect} = React;
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));

const BASE_DRAIN    = { hunger: 1.0, thirst: 1.4, energy: 0.9, fun: 1.2 };
const BASE_RECHARGE = { lake: {thirst: 6}, field: {hunger: 6}, barn: {energy: 8}, play: {fun: 6} };
const DRAIN_GROWTH    = 0.80;
const RECHARGE_GROWTH = 0.50;

function App(){
  const initial={x:15, y:25, needs:{hunger:100,thirst:100,energy:100,fun:100}, level:1, levelTime:30, status:null, eaten:false};
  const [s,setS]=useState(initial);
  const [dragging,setDragging]=useState(false);
  const worldRef=useRef(null);

  const drainMult    = 1 + (s.level-1)*DRAIN_GROWTH;
  const rechargeMult = 1 + (s.level-1)*RECHARGE_GROWTH;

  useEffect(()=>{
    if(s.status) return;
    const dt = 0.1;
    const id = setInterval(()=>{
      setS(prev=>{
        if(prev.status) return prev;
        const current = hitZoneAtPercent(prev.x, prev.y);

        const needs = {...prev.needs};
        needs.hunger = clamp(needs.hunger - BASE_DRAIN.hunger*drainMult*dt, 0, 100);
        needs.thirst = clamp(needs.thirst - BASE_DRAIN.thirst*drainMult*dt, 0, 100);
        needs.energy = clamp(needs.energy - BASE_DRAIN.energy*drainMult*dt, 0, 100);
        needs.fun    = clamp(needs.fun    - BASE_DRAIN.fun   *drainMult*dt, 0, 100);

        if(current==='lake')  needs.thirst += BASE_RECHARGE.lake.thirst*rechargeMult*dt;
        if(current==='field') needs.hunger += BASE_RECHARGE.field.hunger*rechargeMult*dt;
        if(current==='barn')  needs.energy += BASE_RECHARGE.barn.energy*rechargeMult*dt;
        if(current==='play')  needs.fun    += BASE_RECHARGE.play.fun*rechargeMult*dt;

        for(const k in needs) needs[k]=clamp(needs[k],0,100);

        if(Object.values(needs).some(v=>v<=0) && !prev.eaten){
          return {...prev, needs, eaten:true};
        }

        const time = prev.levelTime - dt;
        if(time <= 0){
          return {...prev, needs, levelTime:0, status:'nextlevel'};
        }
        return {...prev, needs, levelTime:time};
      });
    }, dt*1000);
    return ()=>clearInterval(id);
  },[s.status, s.level, s.eaten]);

  useEffect(()=>{
    if(s.eaten){
      const timer=setTimeout(()=>setS(prev=>({...prev, status:'gameover'})),4000);
      return ()=>clearTimeout(timer);
    }
  },[s.eaten]);

  function posToPercent(e){
    const r=worldRef.current.getBoundingClientRect();
    const xClient = (e.touches?.[0]) ? e.touches[0].clientX : e.clientX;
    const yClient = (e.touches?.[0]) ? e.touches[0].clientY : e.clientY;
    return {x:clamp((xClient-r.left)/r.width*100,0,100), y:clamp((yClient-r.top)/r.height*100,0,100)};
  }
  function onStart(e){ e.preventDefault(); setDragging(true); const {x,y}=posToPercent(e); setS(p=>({...p,x,y})); }
  function onMove(e){ if(!dragging) return; e.preventDefault(); const {x,y}=posToPercent(e); setS(p=>({...p,x,y})); }
  function onEnd(){ setDragging(false); }

  function hitZoneAtPercent(xPct, yPct){
    if(!worldRef.current) return null;
    const els=[...worldRef.current.querySelectorAll('.grid > .zone')];
    for(const el of els){
      const rr=el.getBoundingClientRect();
      const px=window.innerWidth * (xPct/100);
      const py=window.innerHeight * (yPct/100);
      if(px>rr.left && px<rr.right && py>rr.top && py<rr.bottom){
        if(el.classList.contains('lake')) return 'lake';
        if(el.classList.contains('field')) return 'field';
        if(el.classList.contains('play')) return 'play';
        if(el.classList.contains('barn')) return 'barn';
      }
    }
    return null;
  }

  function restartGame(){ setS(initial); }
  function startNextLevel(){
    setS(prev=>({...prev, level:prev.level+1, needs:{hunger:100,thirst:100,energy:100,fun:100}, levelTime:30, status:null}));
  }
  const currentZone = hitZoneAtPercent(s.x, s.y);

  return (
    <div className="world" ref={worldRef} onMouseMove={onMove} onMouseUp={onEnd} onTouchMove={onMove} onTouchEnd={onEnd}>
      <div className="ui">
        <div className="row">
          <span className="pill">Level: {s.level}</span>
          <span className="pill">Time: {Math.ceil(s.levelTime)}s</span>
          {currentZone && <span className="pill">Here: {currentZone==='lake'?'Lake üíß':currentZone==='field'?'Field üçé':currentZone==='barn'?'Barn üí§':'Play üéà'}</span>}
          <button className="btn" onClick={restartGame}>Restart Game</button>
        </div>
        <div className="row meters">
          {Object.entries({hunger:"üçé",thirst:"üíß",energy:"üí§",fun:"üéà"}).map(([k,em])=>{
            const v=s.needs[k];
            const color = v<50 ? 'red' : 'black';
            return (
              <span className="pill" key={k}>
                {em}
                <span className="meter"><span className="fill" style={{width:`${v}%`, backgroundColor: color}}/></span>
              </span>
            );
          })}
        </div>
      </div>

      <div className="grid">
        <div className="zone lake"><div className="label">Lake üíß</div></div>
        <div className="zone barn"><div className="label">Barn üí§</div><div className="door"></div><div className="stoop"></div></div>
        <div className="zone field"><div className="label">Field üçé</div></div>
        <div className="zone play"><div className="label">Play üéà</div></div>
      </div>

      {!s.eaten && <div className="unicorn" style={{left:`${s.x}%`, top:`${s.y}%`}} onMouseDown={onStart} onTouchStart={onStart}><div className="u-emoji">ü¶Ñ</div></div>}
      {s.eaten && <div className="monster">üëπ</div>}

      {s.status==='gameover' && <div className="modal"><div className="panel"><h2>Game over! Try again!</h2><p>You reached level {s.level}.</p><button className="btn" onClick={restartGame}>Restart</button></div></div>}
      {s.status==='nextlevel' && <div className="modal"><div className="panel"><h2>Congrats! You're going to the next level</h2><p>Bars will drain and recharge faster every level!</p><button className="btn" onClick={startNextLevel}>Start Level {s.level+1}</button></div></div>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('app')).render(<App/>);
</script>
</body>
</html>
