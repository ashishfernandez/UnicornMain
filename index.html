<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unicorn Ranch</title>
<meta name="description" content="Raise a baby unicorn – keep needs filled to level up!" />
<style>
  :root{
    --sky1:#9fd3ff; --sky2:#cfe8ff; --grass:#b8e986; --water:#9fd3ff;
    --barn1:#f77; --barn2:#d26; --dirt:#e2c39a;
  }
  html,body{
    margin:0; height:100%;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:linear-gradient(var(--sky1),var(--sky2) 30%,var(--grass) 30%);
  }
  #app{min-height:100dvh; display:grid; place-items:center; padding:12px;}

  .world{
    position:relative;
    width:min(96vw,1100px);
    aspect-ratio:16/10;
    border-radius:24px; overflow:hidden;
    box-shadow:0 10px 40px rgba(0,0,0,.15);
    background:linear-gradient(var(--sky1),var(--sky2) 35%, var(--grass) 35%);
  }

  /* Top UI */
  .ui{ position:absolute; inset:12px 12px auto 12px; display:flex; flex-wrap:wrap; gap:10px; }
  .card{
    background:rgba(255,255,255,.92);
    padding:10px 12px; border-radius:14px;
    box-shadow:0 2px 8px rgba(0,0,0,.1);
    display:flex; flex-direction:column; gap:8px;
    max-width:calc(100% - 24px);
  }
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
  .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:999px; background:#fff; font-weight:700;}
  .btn{cursor:pointer; padding:8px 14px; border-radius:10px; border:none; font-weight:700; background:#fff;}
  .btn:hover{filter:brightness(.97);}

  /* Meters */
  .meters{display:flex; gap:10px; flex-wrap:wrap;}
  .meter{width:160px; max-width:32vw; height:12px; background:#d3d3d3; border-radius:20px; overflow:hidden;}
  .fill{display:block; height:100%; background:#000; transition:width .15s linear;}

  /* 2×2 grid for zones */
  .grid{
    position:absolute; left:2%; right:2%; top:28%; bottom:4%;
    display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr; gap:2.5%;
  }
  .zone{position:relative; border-radius:20px; outline:4px solid rgba(255,255,255,.6); overflow:hidden;}
  .label{position:absolute; top:8px; left:8px; padding:4px 10px; background:rgba(255,255,255,.9); border-radius:12px; font-weight:700; font-size:14px; z-index:2;}
  .lake{background:radial-gradient(circle at 40% 30%, #e7f6ff, var(--water));}
  .field{background:repeating-linear-gradient(45deg, rgba(255,255,255,.35), rgba(255,255,255,.35) 10px, transparent 10px, transparent 20px);}
  .play{background:linear-gradient(135deg, #fef3bd, #ffd6a5);}
  .barn{background:linear-gradient(var(--barn1), var(--barn2));}
  .barn .door{position:absolute; left:50%; bottom:0; transform:translateX(-50%); width:28%; height:60%; background:#4b8a16; border:6px solid #2f2614; border-bottom:none; border-radius:10px 10px 0 0;}
  .barn .stoop{position:absolute; left:14%; right:14%; bottom:-8%; height:14%; background:var(--dirt); border-radius:20px;}

  /* Unicorn */
  .unicorn{position:absolute; width:min(12vmin, 120px); height:min(12vmin, 120px); translate:-50% -50%; user-select:none; touch-action:none;}
  .u-emoji{font-size:64px; line-height:1; position:absolute; left:50%; top:50%; translate:-50% -50%;}
  .speech{position:absolute; left:0; top:-12px; translate:-10% -100%; background:#fff; padding:6px 10px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.2); font-weight:700;}

  /* Modal */
  .modal{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.5);}
  .panel{background:#fff; padding:22px; border-radius:16px; width:min(92%,520px); text-align:center;}
  .panel h2{margin:0 0 10px;}
  .panel p{margin:0 0 16px;}
</style>
</head>
<body>
  <div id="app"></div>

  <!-- React UMD + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const {useState,useRef,useEffect} = React;
    const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
    const STORAGE_KEY='unicorn_ranch_levels_v1';

    // Base rates (per second). These will scale up each level.
    const BASE_DRAIN   = { hunger: 1.0, thirst: 1.4, energy: 0.9, fun: 1.2 };
    const BASE_RECHARGE= { lake: {thirst: 6}, field: {hunger: 6}, barn: {energy: 8}, play: {fun: 6} };

    // How much the difficulty increases per level (multiplier)
    const DRAIN_GROWTH   = 0.20;   // +20% drain per level
    const RECHARGE_GROWTH= 0.25;   // +25% recharge per level

    function useLocalStorageState(key, initial){
      const [state,setState]=useState(()=>{ try{ const raw=localStorage.getItem(key); return raw? JSON.parse(raw): initial;}catch{ return initial; }});
      useEffect(()=>{ try{ localStorage.setItem(key, JSON.stringify(state)); }catch{} },[state]);
      return [state,setState];
    }

    function App(){
      const initial={
        x:15, y:25,
        needs:{hunger:80,thirst:80,energy:80,fun:70},
        level:1,
        levelTime:15,              // seconds remaining in current level
        status:null,               // 'gameover' | 'nextlevel' | null
      };
      const [s,setS]=useLocalStorageState(STORAGE_KEY, initial);
      const [dragging,setDragging]=useState(false);
      const worldRef=useRef(null);

      // Derived multipliers from level
      const drainMult    = 1 + (s.level-1)*DRAIN_GROWTH;
      const rechargeMult = 1 + (s.level-1)*RECHARGE_GROWTH;

      // Main game loop @ 10Hz
      useEffect(()=>{
        if(s.status) return; // pause when modal is open
        const dt = 0.1;
        const id = setInterval(()=>{
          setS(prev=>{
            // Early exit if already paused/status
            if(prev.status) return prev;

            // Compute current zone by position
            const current = hitZoneAtPercent(prev.x, prev.y);

            // Drain
            const d = BASE_DRAIN;
            const needs = {...prev.needs};
            needs.hunger = clamp(needs.hunger - d.hunger*drainMult*dt, 0, 100);
            needs.thirst = clamp(needs.thirst - d.thirst*drainMult*dt, 0, 100);
            needs.energy = clamp(needs.energy - d.energy*drainMult*dt, 0, 100);
            needs.fun    = clamp(needs.fun    - d.fun   *drainMult*dt, 0, 100);

            // Recharge matching need only
            const r = BASE_RECHARGE;
            if(current==='lake')  needs.thirst = clamp(needs.thirst + r.lake.thirst  *rechargeMult*dt, 0, 100);
            if(current==='field') needs.hunger = clamp(needs.hunger + r.field.hunger *rechargeMult*dt, 0, 100);
            if(current==='barn')  needs.energy = clamp(needs.energy + r.barn.energy  *rechargeMult*dt, 0, 100);
            if(current==='play')  needs.fun    = clamp(needs.fun    + r.play.fun     *rechargeMult*dt, 0, 100);

            // Game over check (any bar empty)
            if(needs.hunger<=0 || needs.thirst<=0 || needs.energy<=0 || needs.fun<=0){
              return {...prev, needs, status:'gameover'};
            }

            // Level timer countdown
            let time = prev.levelTime - dt;
            if(time <= 0){
              // Survived! Next level message; pause loop via status
              return {...prev, needs, levelTime:0, status:'nextlevel'};
            }

            return {...prev, needs, levelTime:time};
          });
        }, dt*1000);
        return ()=>clearInterval(id);
      },[s.status, s.level, drainMult, rechargeMult]);

      // Pointer helpers
      function posToPercent(e){
        const r=worldRef.current.getBoundingClientRect();
        const cx=(e.clientX??e.touches?.[0]?.clientX)-r.left;
        const cy=(e.clientY??e.touches?.[0]?.clientY)-r.top;
        return {x:clamp((cx/r.width)*100,0,100), y:clamp((cy/r.height)*100,0,100)};
      }
      function onStart(e){ setDragging(true); const {x,y}=posToPercent(e); setS(p=>({...p,x,y})); }
      function onMove(e){ if(!dragging) return; const {x,y}=posToPercent(e); setS(p=>({...p,x,y})); }
      function onEnd(){ setDragging(false); }

      // Which zone contains (x%, y%)?
      function hitZoneAtPercent(xPct, yPct){
        if(!worldRef.current) return null;
        const rWorld=worldRef.current.getBoundingClientRect();
        const px=rWorld.left + (xPct/100)*rWorld.width;
        const py=rWorld.top  + (yPct/100)*rWorld.height;
        const els=[...worldRef.current.querySelectorAll('.grid > .zone')];
        for(const el of els){
          const rr=el.getBoundingClientRect();
          if(px>rr.left && px<rr.right && py>rr.top && py<rr.bottom){
            if(el.classList.contains('lake')) return 'lake';
            if(el.classList.contains('field')) return 'field';
            if(el.classList.contains('play')) return 'play';
            if(el.classList.contains('barn')) return 'barn';
          }
        }
        return null;
      }

      function restartGame(){
        setS({
          x:15, y:25,
          needs:{hunger:80,thirst:80,energy:80,fun:70},
          level:1,
          levelTime:15,
          status:null,
        });
      }

      function goToNextLevel(){
        setS(prev=>({
          ...prev,
          level: prev.level + 1,
          levelTime: 15,
          status: null
        }));
      }

      const currentZone = hitZoneAtPercent(s.x, s.y);

      return (
        <div className="world"
             ref={worldRef}
             onMouseMove={onMove} onMouseUp={onEnd}
             onTouchMove={onMove} onTouchEnd={onEnd}
        >
          {/* UI */}
          <div className="ui">
            <div className="card">
              <div className="row">
                <span className="pill">Level: {s.level}</span>
                <span className="pill">Time: {Math.ceil(s.levelTime)}s</span>
                {currentZone && <span className="pill">
                  Here: {currentZone==='lake'?'Lake 💧':currentZone==='field'?'Field 🍎':currentZone==='barn'?'Barn 💤':'Play 🎈'}
                </span>}
              </div>
              <div className="meters">
                {Object.entries({hunger:"🍎",thirst:"💧",energy:"🛌",fun:"🎈"}).map(([k,em])=>{
                  const v=s.needs[k];
                  return (
                    <span className="pill" key={k}>
                      <span style={{fontSize:18}}>{em}</span>
                      <span className="meter"><span className="fill" style={{width:`${v}%`}}/></span>
                    </span>
                  );
                })}
              </div>
            </div>
          </div>

          {/* 2×2 zones */}
          <div className="grid">
            <div className="zone lake"><div className="label">Lake 💧</div></div>
            <div className="zone barn"><div className="label">Barn 💤</div><div className="door"></div><div className="stoop"></div></div>
            <div className="zone field"><div className="label">Field 🍎</div></div>
            <div className="zone play"><div className="label">Play 🎈</div></div>
          </div>

          {/* Unicorn */}
          <div className="unicorn" style={{left:`${s.x}%`, top:`${s.y}%`}}
               onMouseDown={onStart} onTouchStart={onStart}>
            <div className="u-emoji">🦄</div>
          </div>

          {/* Status Modals */}
          {s.status==='gameover' && (
            <div className="modal">
              <div className="panel">
                <h2>Game over! Try again!</h2>
                <p>You reached level {s.level}.</p>
                <button className="btn" onClick={restartGame}>Restart</button>
              </div>
            </div>
          )}
          {s.status==='nextlevel' && (
            <div className="modal">
              <div className="panel">
                <h2>Congrats! You're going to the next level</h2>
                <p>Bars will drain and recharge faster.</p>
                <button className="btn" onClick={goToNextLevel}>Start Level {s.level+1}</button>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('app')).render(<App/>);
  </script>
</body>
</html>
